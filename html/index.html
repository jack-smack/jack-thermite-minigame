<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thermite Game</title>
  <style>
    .gameGrid {
      display: grid;
      grid-template-columns: repeat(2, 80px); 
      grid-template-rows: repeat(3, 80px);
      gap: 5px;
      margin-left:0.2vw;
      margin-right:0.2vw;
    }
    .targetGrid {
      display: grid;
      grid-template-columns: repeat(1, 80px); 
      grid-template-rows: repeat(2, 80px);
      gap: 5px;
      -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
    }
    .heatValueGrid {
      display: grid;
      grid-template-columns: repeat(1, 80px); 
      grid-template-rows: repeat(3, 80px);
      gap: 5px;
      -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
    }
    .tile {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
    }
    .targetTile {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
  </style>
</head>
<body>
    <div style="display: flex; align-items: center; justify-content: center; margin-top: 20vh; flex-direction: column;">
        <div style="display: flex; align-items: center; justify-content: center; flex-direction: row;">
            <div class="targetGrid" id="targetGrid"></div>
            <div class="heatValueGrid" id="heatValueGrid3"></div>
            <div class="gameGrid" id="gameGrid3"></div>
            <div class="heatValueGrid" id="heatValueGrid2"></div>
            <div class="gameGrid" id="gameGrid2"></div>
            <div class="heatValueGrid" id="heatValueGrid1"></div>
            <div class="gameGrid" id="gameGrid1"></div>
            <div id="lightFireButton" style="width: 120px; height: 120px; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <img style="width: 100%; height: 100%;" src="assets/FireIcon.png" />
                <div id="startFireValueText" style="font-size: xx-large;">10</div>
            </div>
        </div>
    </div>
   


  <script>
    const gameGridData = [
        [1,1,0,0,1,1],
        [1,1,1,0,0,1],
        [1,0,1,1,0,0],
    ];
    const targetHeat = [Math.floor(Math.random()*(6561-6) + 6), Math.floor(Math.random()*(6561-6) + 6), Math.floor(Math.random()*(6561-6) + 6)];
    const gameGrid1 = document.getElementById('gameGrid1');
    const gameGrid2 = document.getElementById('gameGrid2');
    const gameGrid3 = document.getElementById('gameGrid3');

    const startFireValue = Math.floor(Math.random()*(25-1)+1);
    document.getElementById("startFireValueText").textContent=startFireValue;

    const targetGrid = document.getElementById('targetGrid');
    const heatValueGrid1 = document.getElementById('heatValueGrid1');
    const heatValueGrid2 = document.getElementById('heatValueGrid2');
    const heatValueGrid3 = document.getElementById('heatValueGrid3');

    for(let i=0; i<3; i++){
        const tile = document.createElement('div');
        tile.classList.add('targetTile');
        tile.textContent = targetHeat[i];
        targetGrid.appendChild(tile);
    }
    let fireLit = false;
    let draggedTile = null;
    let draggedPosition = null;
    function renderGrid(){
        gameGrid3.innerHTML = '';
        gameGrid2.innerHTML = '';
        gameGrid1.innerHTML = '';

        for(let i = 0; i<3; i++){
            for(let j=0; j<6;j++){
                const tile = createTile(i, j);
                //tile.textContent= `(${i}, ${j})`;
                if(j<2){gameGrid3.appendChild(tile);}
                else if(j<4){gameGrid2.appendChild(tile);}
                else{gameGrid1.appendChild(tile);}
            }
        }
    }
    renderGrid();
    function createTile(row, col){
        const tile = document.createElement('div');
        tile.classList.add('tile');

        const img = document.createElement('img');
        let type = gameGridData[row][col];
        if(type){
            img.src='assets/AlIcon.png';
        }
        else{
            img.src='assets/FeOICON.png'
        }
        tile.dataset.row=row;
        tile.dataset.col=col;
        tile.appendChild(img);

        tile.addEventListener('dragstart', handleDragStart);
        tile.addEventListener('dragover', handleDragOver);
        tile.addEventListener('drop', handleDrop);

        return tile;
    }
    function handleDragStart(event) {
        if(!fireLit){
            draggedTile = event.target.parentElement;
            draggedPosition={row: parseInt(draggedTile.dataset.row), col: parseInt(draggedTile.dataset.col)};
        }
    }

    function handleDragOver(event) {
      event.preventDefault(); 
    }

    function handleDrop(event) {
        if(!fireLit){
            event.preventDefault();
            const targetTile = event.target.closest('.tile');
            if(!targetTile){ return; }

            const targetPosition = {
                row:parseInt(targetTile.dataset.row),
                col:parseInt(targetTile.dataset.col)
            };
            if(isNeighbour(draggedPosition, targetPosition)){
                let temp = gameGridData[draggedPosition.row][draggedPosition.col];
                gameGridData[draggedPosition.row][draggedPosition.col] = gameGridData[targetPosition.row][targetPosition.col];
                gameGridData[targetPosition.row][targetPosition.col] = temp;
                renderGrid();
            }
        }
    }
    function isNeighbour(pos1, pos2){
        const rowDiff = Math.abs(pos1.row - pos2.row);
        const colDiff = Math.abs(pos1.col - pos2.col);
        return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);
    }
    document.getElementById("lightFireButton").addEventListener("click", LightFire);
    var i = 0;
    var j = 5;
    function FireLoop(){
        if(j<0){return;}
        setTimeout(function(){
            let prevValue = startFireValue;
            if(j<5){
                prevValue=gameGridData[i][j+1];
            }

            if(!gameGridData[i][j]){
                console.log(`multiply ${i},${j}`);
                gameGridData[i][j] = Math.floor(prevValue*2);
            }else{
                console.log(`add ${i},${j} = ${Math.floor(prevValue+1)}`);
                gameGridData[i][j] = Math.floor(prevValue+1);
            }

            const tile = document.createElement('div');
            tile.classList.add('targetTile');
            tile.textContent = gameGridData[i][j];
            if(j==4){
                heatValueGrid1.appendChild(tile);
            }
            if(j==2){
                heatValueGrid2.appendChild(tile);
            }
            if(j==0){
                console.log(`prev ${i},${j}: ${prevValue}`);
                heatValueGrid3.appendChild(tile);
            }
            
           
            
            i++;
            if(j>0){
                FireLoop();
            }
            if(i>2){
                j--;
                i=0;
                FireLoop();
            }
        },400)
    }
    function LightFire(){
        fireLit=true;
        FireLoop();
    }

  </script>
</body>
</html>
